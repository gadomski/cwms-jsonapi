<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>cwms-jsonapi by gadomski</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>cwms-jsonapi</h1>
        <h2>Documentation for a CWMS JSON API</h2>
        <a href="https://github.com/gadomski/cwms-jsonapi" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h3>
<a name="welcome-to-a-cwms-json-api" class="anchor" href="#welcome-to-a-cwms-json-api"><span class="octicon octicon-link"></span></a>Welcome to <em>a</em> CWMS JSON API.</h3>

<p>This is the documentation for <em>a</em> (not <em>the</em>) JSON API for the <a href="https://cwms.usace.army.mil">Corps Water Management System</a>, or <strong>CWMS</strong>.
This is <strong>not</strong> the API code itself.
At the time of this writing, the API code is available only on the server located at <code>155.78.180.103</code> in the <code>cwmsweb</code> schema.
This document only describes the data provided by the API.</p>

<h3>
<a name="schema" class="anchor" href="#schema"><span class="octicon octicon-link"></span></a>Schema</h3>

<p>All data is received as JSON.</p>

<pre><code>$ curl -i http://nae-rrs2.usace.army.mil:7777/pls/cwmsweb/jsonapi.locations?db_office_id=FOO
HTTP/1.1 200 OK
Date: Tue, 03 Jun 2014 20:09:24 GMT
Server: Oracle-Application-Server-11g
X-DB-Content-length: 2
Content-Length: 2
Content-Type: application/json
Content-Language: en

[]
</code></pre>

<p>Blank fields are included as <code>null</code> instead of being omitted.</p>

<p>All timestamps are returned in ISO 8601 format:</p>

<pre><code>YYYY-MM-DDTHH:MM:SSZ
</code></pre>

<h3>
<a name="url-structure" class="anchor" href="#url-structure"><span class="octicon octicon-link"></span></a>URL Structure</h3>

<p>Due to the idiosyncrasies of <a href="http://docs.oracle.com/cd/B14099_19/web.1012/b14010/using.htm">mod_plsql</a>, <strong>cwms-jsonapi</strong> eschews traditional API behavior in favor of easy integration with existing PL/SQL web packages. Consequentially, an API call might look like:</p>

<pre><code>http://nae-rrs2.usace.army.mil:7777/pls/cwmsweb/jsonapi.locations?db_office_id=NAE
</code></pre>

<p>Where everything after <code>http://nae-rrs2.usace.army.mil:7777/pls/cwmsweb/jsonapi</code> is used to query the API. the <code>GET</code> parameters in the URL are passed as procedure arguments in the PL/SQL backend, so misspelling <code>GET</code> parameter names will produce <code>404</code> with error messages that look suspiciously internally generated (its because they are).</p>

<p>In this documentation, urls are listed with a dot, then the resource name, then the parameters, for example, if your base API url is <code>http://example.com/pls/cwmsweb/jsonapi</code>, then the URL for a list of locations would be:</p>

<pre><code>.locations?db_office_id=MYOFFICE
</code></pre>

<h3>
<a name="http-verbs" class="anchor" href="#http-verbs"><span class="octicon octicon-link"></span></a>HTTP Verbs</h3>

<p>The API only accepts <code>GET</code> requests.</p>

<h3>
<a name="locations" class="anchor" href="#locations"><span class="octicon octicon-link"></span></a>Locations</h3>

<p><strong>Locations</strong> are field sites that may contain one or more sensors, some of which may produce time series data. To get a list of locations, query:</p>

<pre><code>.locations?db_office_id=OFFICE_ID
</code></pre>

<h4>
<a name="parameters" class="anchor" href="#parameters"><span class="octicon octicon-link"></span></a>Parameters</h4>

<ul>
<li>
<strong>db_office_id</strong>: [string, required] The office id, e.g. 'NAE'</li>
<li>
<strong>unit_system</strong>: [string] A given location usually has two database representations, one for each unit system ('SI' or 'EN'), default 'SI'</li>
</ul><h4>
<a name="response" class="anchor" href="#response"><span class="octicon octicon-link"></span></a>Response</h4>

<div class="highlight highlight-json"><pre><span class="p">[</span>
  <span class="p">{</span>
    <span class="nt">"active_flag"</span><span class="p">:</span> <span class="s2">"T"</span><span class="p">,</span>
    <span class="nt">"db_office_id"</span><span class="p">:</span> <span class="s2">"NAE"</span><span class="p">,</span> 
    <span class="nt">"elevation"</span><span class="p">:</span> <span class="mf">102.12</span><span class="p">,</span>
    <span class="nt">"longtitude"</span><span class="p">:</span> <span class="mf">-72.6219</span><span class="p">,</span>
    <span class="nt">"latitude"</span><span class="p">:</span> <span class="mf">42.3108</span><span class="p">,</span>
    <span class="nt">"location_id"</span><span class="p">:</span> <span class="s2">"NOR"</span><span class="p">,</span>
    <span class="nt">"location_type"</span><span class="p">:</span> <span class="s2">"Pool Gage"</span><span class="p">,</span>
    <span class="nt">"long_name"</span><span class="p">:</span> <span class="s2">"Connecticut River at North Hampton, MA"</span><span class="p">,</span>
    <span class="nt">"state_initial"</span><span class="p">:</span> <span class="s2">"MA"</span><span class="p">,</span>
    <span class="nt">"time_zone_name"</span><span class="p">:</span> <span class="s2">"US/Eastern"</span><span class="p">,</span>
    <span class="nt">"unit_id"</span><span class="p">:</span> <span class="s2">"m"</span><span class="p">,</span>
    <span class="nt">"unit_system"</span><span class="p">:</span> <span class="s2">"SI"</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>

<h3>
<a name="location" class="anchor" href="#location"><span class="octicon octicon-link"></span></a>Location</h3>

<p>To query a single location:</p>

<pre><code>.locations?location_id=LOCATION_ID
</code></pre>

<p>At the time of this writing, the returned data for a single location has the same format of a single entry in the <code>locations</code> array, returned above.</p>

<h3>
<a name="timeseries" class="anchor" href="#timeseries"><span class="octicon octicon-link"></span></a>Timeseries</h3>

<p>To query for information about all <strong>timeseries</strong> for a given location:</p>

<pre><code>.timeseries?location_id=LOCATION_ID
</code></pre>

<h4>
<a name="response-1" class="anchor" href="#response-1"><span class="octicon octicon-link"></span></a>Response</h4>

<div class="highlight highlight-json"><pre><span class="p">[</span>
  <span class="p">{</span>
    <span class="nt">"cwms_ts_id"</span><span class="p">:</span> <span class="s2">"HUB.Stage-ICE7.Inst.6Hours.0.DCP-raw"</span><span class="p">,</span>
    <span class="nt">"db_office_id"</span><span class="p">:</span> <span class="s2">"NAE"</span><span class="p">,</span>
    <span class="nt">"location_id"</span><span class="p">:</span> <span class="s2">"HUB"</span><span class="p">,</span>
    <span class="nt">"parameter_id"</span><span class="p">:</span> <span class="s2">"Stage-ICE7"</span><span class="p">,</span>
    <span class="nt">"ts_code"</span><span class="p">:</span> <span class="mi">8578021</span><span class="p">,</span>
    <span class="nt">"unit_id"</span><span class="p">:</span> <span class="s2">"m"</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>

<h3>
<a name="timeseries-data" class="anchor" href="#timeseries-data"><span class="octicon octicon-link"></span></a>Timeseries Data</h3>

<p>To retrieve timeseries data from a given location:</p>

<pre><code>.timeseriesdata?ts_code=TS_CODE
</code></pre>

<h4>
<a name="response-2" class="anchor" href="#response-2"><span class="octicon octicon-link"></span></a>Response</h4>

<div class="highlight highlight-json"><pre><span class="p">[</span>
  <span class="p">{</span>
    <span class="nt">"date_time"</span><span class="p">:</span> <span class="s2">"2007-06-01T00:00:00"</span><span class="p">,</span>
    <span class="nt">"quality_code"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">"ts_code"</span><span class="p">:</span> <span class="mi">8578021</span><span class="p">,</span>
    <span class="nt">"value"</span><span class="p">:</span> <span class="mf">489.31999999999999</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/gadomski/cwms-jsonapi/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/gadomski/cwms-jsonapi/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/gadomski/cwms-jsonapi"></a> is maintained by <a href="https://github.com/gadomski">gadomski</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>